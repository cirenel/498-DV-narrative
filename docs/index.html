<!DOCTYPE html>

<html>
	<head>
		<script src='https://d3js.org/d3.v5.min.js'></script>
		<style>
			#tip{
				opacity : 0;
				position : absolute;
				text-align : center;
				width : 100;
				height : 30;
				background : white;
				border-width : 1px;
				border-style :  double;
				border-color : black;
				border-radius : 3px;
				padding-top : 2px;
				padding-bottom : 2px;
				padding-left : 3px;
				padding-right : 3px;
				cursor :none;
			}
			
						
			div{
				border-width : 1px; 
				border-radius: 3px;
				border-color : black;
				border-style : solid;
				padding-top : 2px;
				padding-bottom : 2px;
				padding-left : 3px;
				padding-right : 3px;
			}
		</style>
		
	</head>

	<body onload='init()'>
		<h1> An Exploration of Video Game Releases.</h1>
		<div style="float:left">
			<svg width=1100 height=500 id=yearrelease>
			</svg>
		</div>
		<div style="float:right">
			<p>Since the birth of console and home gaming <br> options in the 1980s, the video game industry has <br> boomed.
			Despite some early flops, the number of <br> video game titles released every year has continued <br> to grow. </p>
			<p>More information for each chart can <br>be seen by hovering on the individual chart <br> elements.</p>
			<a href = "slide2.html" style="float:right"> Next </a>
		</div>
		<div id = "tip"></div>
		
		<script>

		var data;
		var margin = 50;
		var height = 500;
		var width = 1100;
		async function init(){

			data =  await d3.csv("https://raw.githubusercontent.com/cirenel/498-DV-narrative/master/salesnumyear.csv")
			.then(function(data){

				var len = data.length;
				
				var xScale = d3.scaleLinear().domain([1980, 2017]).range([margin,width-margin]); 
				var yScale = d3.scaleLinear().domain([1700, 5]).range([margin,height-margin]); 
				var colorScale = d3.scaleSequential(d3.interpolateViridis).domain([-1000, 2500]);
				
				var line = d3.line()
				.x(function(d){return xScale(+d.year);})
				.y(function(d){return yScale(+d.numGames);});
				
				d3.select("#yearrelease")
				.append("g").append("path").data([data])
				.attr("d", line)
				.attr("stroke", "black").attr("stroke-width",1).attr("fill","none");
				
				var tip = d3.select("#tip");
				
				var xAnnote = 1982;
				var yAnnote = 0;
				d3.select("#yearrelease").select("g").selectAll("circle").data(data).enter().append("circle")
				.attr("r", 4).attr("fill", function(d){return ""+colorScale(+d.numGames);})
				.attr("cx", function(d, i){return xScale(+d.year);})
				.attr("cy", function(d, i){
					if(+d.year == xAnnote){yAnnote = +d.globalSales;}
					return yScale(+d.numGames);})
				.attr("stroke","none")
				.on("mouseover", function (d){
						tip.style("opacity", 1)
						.style("left", (d3.event.pageX + 10)+"px")
						.style("top", (d3.event.pageY -10)+"px")
						.html(d.numGames+" games released in "+d.year);})
				.on("mouseout", function(){
					tip.style("opacity", 0);});
				
				d3.select("#yearrelease").append("g").attr("transform","translate(0,"+ (height - margin) +" )").call(d3.axisBottom(xScale).tickFormat(d3.format("d")));
				d3.select("#yearrelease").append("g").attr("transform","translate(50,0)").call(d3.axisLeft(yScale)); 
				
				d3.select("#yearrelease")
				.append("text").attr("transform", "translate("+(xScale(xAnnote)+5)+","+(yScale(yAnnote)-7)+" ) rotate(-90) ")
				.attr("fill", "black").attr("text-anchor","start").html("Infamous ET Game Released");

				
				d3.select("#yearrelease").append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 10)
				.attr("x", 0-(height/2)) 
				.style("text-anchor", "middle")
				.text("Games Released");

				d3.select("#yearrelease").append("text")
				.attr("y", height)
				.attr("x", width/2) 
				.style("text-anchor", "middle")
				.text("Year");	

				d3.select("#yearrelease").append("text")
				.attr("y", margin)
				.attr("x", width/2) 
				.style("text-anchor", "middle")
				.text("Games Released by Year");				
				
				
			})
			.catch(function(err){
				console.log("boop "+data);
			})


		}
			
		</script>
	
	</body>
</html>
